<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>vidaXL | EU Bed Size Mapper</title>

<!-- Put your logo image in repo root as logo.png -->
<link rel="icon" type="image/png" href="logo.png">

<style>
:root{
  --vx-bg:#D3b7da;
  --vx-green:#16a34a;
  --vx-green-2:#22c55e;
  --vx-orange:#ff6a00;
  --vx-orange-2:#ff8a2b;
  --vx-ink:#111827;
  --vx-muted:#6b7280;
  --vx-card:rgba(255,255,255,.92);
  --vx-shadow:0 14px 34px rgba(0,0,0,.18);
  --vx-radius:18px;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:linear-gradient(180deg,var(--vx-bg),var(--vx-bg));
  color:#1f2937;
  min-height:100vh;
}

.wrap{max-width:1120px;margin:26px auto;padding:0 18px 44px}

.topbar{
  display:flex;justify-content:space-between;align-items:center;
  padding:14px 16px;
  border-radius:20px;
  background:rgba(255,255,255,.12);
  color:#fff;
  box-shadow:var(--vx-shadow);
}

.brand{display:flex;gap:12px;align-items:center}
.logoWrap{
  width:44px;height:44px;border-radius:14px;
  background:rgba(255,255,255,.15);
  display:grid;place-items:center;
}
.logoWrap img{width:44px;height:44px;object-fit:cover}

h1{font-size:16px;margin:0}
.subtitle{font-size:12.5px;opacity:.85}

.badge{
  font-size:12px;
  padding:6px 10px;
  border-radius:999px;
  background:rgba(0,0,0,.25);
  display:flex;align-items:center;gap:8px;
}
.dot{width:8px;height:8px;border-radius:50%;background:#bbb}
.dot.ok{background:#22c55e}
.dot.warn{background:#f59e0b}

.grid{
  display:grid;
  grid-template-columns:1.25fr .75fr;
  gap:18px;
  margin-top:18px;
}
@media(max-width:980px){.grid{grid-template-columns:1fr}}

.card{
  background:var(--vx-card);
  border-radius:var(--vx-radius);
  box-shadow:var(--vx-shadow);
  padding:16px;
}

h2{font-size:14px;margin:0 0 6px;color:var(--vx-ink)}
.muted{font-size:13px;color:var(--vx-muted)}
.small{font-size:12px}

label{
  display:block;
  font-size:12px;
  font-weight:800;
  margin:12px 0 6px;
}

input[type=text]{
  width:100%;
  padding:10px 12px;
  border-radius:12px;
  border:1px solid rgba(0,0,0,.15);
}

.form-grid{
  display:grid;
  grid-template-columns:repeat(3,minmax(0,1fr));
  gap:14px 16px;
  margin-top:12px;
}
@media(max-width:900px){.form-grid{grid-template-columns:1fr}}

.actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}

button{
  padding:10px 14px;
  border-radius:12px;
  border:none;
  font-weight:900;
  cursor:pointer;
}

.btn-upload{
  background:linear-gradient(135deg,var(--vx-green),var(--vx-green-2));
  color:#fff;
}
.btn-exec{
  background:linear-gradient(135deg,var(--vx-orange),var(--vx-orange-2));
  color:#fff;
}
.btn-ghost{
  background:#fff;
  box-shadow:0 6px 16px rgba(0,0,0,.1);
}
button:disabled{opacity:.5;cursor:not-allowed}

#fileInput{display:none}
.fileline{
  margin-top:12px;
  padding:10px 12px;
  border-radius:12px;
  border:1px dashed rgba(147,17,126,.3);
  background:rgba(147,17,126,.06);
  display:flex;justify-content:space-between;flex-wrap:wrap;
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:12px;
}
th,td{
  padding:10px;
  border-bottom:1px solid rgba(0,0,0,.1);
  font-size:13px;
}
th{background:#f9fafb;color:#6b7280;font-size:12px}

/* Bullet list */
.sizes-list{
  margin:8px 0 0;
  padding-left:18px;
  font-size:12px;
  line-height:1.5;
}
.sizes-list li{margin:4px 0}
</style>
</head>

<body>
<div class="wrap">

<div class="topbar">
  <div class="brand">
    <div class="logoWrap"><img src="logo.png"></div>
    <div>
      <h1>EU Bed Size Mapper</h1>
      <div class="subtitle">Auto-detects CSV delimiter</div>
    </div>
  </div>
  <div class="badge">
    <span class="dot" id="statusDot"></span>
    <span id="statusText">Waiting for fileâ€¦</span>
  </div>
</div>

<div class="grid">

<div class="card">
  <h2>Import & mapping</h2>
  <div class="muted">Runs locally in your browser.</div>

  <input id="fileInput" type="file" accept=".csv">
  <div class="actions">
    <button class="btn-upload" id="uploadBtn">Upload CSV</button>
  </div>

  <div class="fileline" id="fileLine" style="display:none">
    <div>
      <strong id="fileName"></strong>
      <div class="small muted" id="fileMeta"></div>
    </div>
    <button class="btn-ghost" id="changeFileBtn">Change</button>
  </div>

  <div class="form-grid">
    <div><label>Item column</label><input id="itemCol"></div>
    <div><label>Width column</label><input id="wCol"></div>
    <div><label>Length column</label><input id="lCol"></div>
  </div>

  <div class="actions">
    <button class="btn-exec" id="processBtn">Execute</button>
    <button class="btn-ghost" id="downloadBtn" disabled>Download CSV</button>
  </div>
</div>

<div class="card">
  <h2>Standard sizes</h2>
  <ul class="sizes-list" id="sizesList"></ul>
</div>

</div>

<div class="card" style="margin-top:18px">
  <h2>Preview</h2>
  <div id="previewWrap"></div>
</div>

</div>

<script>
const STANDARD_SIZES=[
  {name:"Single",w:80,l:200},
  {name:"Single",w:90,l:200},
  {name:"Small Double",w:120,l:200},
  {name:"Double",w:140,l:200},
  {name:"King",w:160,l:200},
  {name:"Super King",w:180,l:200},
  {name:"Extra Large",w:200,l:200},
];

const sizesList=document.getElementById("sizesList");
STANDARD_SIZES.forEach(s=>{
  const li=document.createElement("li");
  li.textContent=`${s.w}x${s.l} (${s.name})`;
  sizesList.appendChild(li);
});

function detectDelimiter(text){
  const lines=text.split(/\r?\n/).slice(0,5).join("\n");
  const candidates=[",",";","\t"];
  let best={d:",",score:-1};
  for(const d of candidates){
    const c=lines.split(d).length;
    if(c>best.score) best={d,score:c};
  }
  return best.d;
}

const fileInput=document.getElementById("fileInput");
const uploadBtn=document.getElementById("uploadBtn");
const changeFileBtn=document.getElementById("changeFileBtn");
const fileLine=document.getElementById("fileLine");
const fileName=document.getElementById("fileName");
const fileMeta=document.getElementById("fileMeta");
const processBtn=document.getElementById("processBtn");
const downloadBtn=document.getElementById("downloadBtn");
const previewWrap=document.getElementById("previewWrap");
const statusDot=document.getElementById("statusDot");
const statusText=document.getElementById("statusText");

uploadBtn.onclick=()=>fileInput.click();
changeFileBtn.onclick=()=>fileInput.click();

fileInput.onchange=()=>{
  const f=fileInput.files[0];
  if(!f)return;
  fileLine.style.display="flex";
  fileName.textContent=f.name;
  fileMeta.textContent=Math.round(f.size/1024)+" KB";
  statusText.textContent="Ready";
  statusDot.className="dot ok";
};

processBtn.onclick=async()=>{
  if(!fileInput.files.length)return;
  const text=await fileInput.files[0].text();

  const delimiter=detectDelimiter(text);
  const rows=text.trim().split("\n").map(r=>r.split(delimiter));

  const out=[...rows[0],"proposed_standard_size","proposed_standard_name","distance"];
  const body=[];

  for(let i=1;i<rows.length;i++){
    const r=rows[i];
    const w=+r[1],l=+r[2];
    if(!w||!l){body.push([...r,"","",""]);continue;}
    let best=null;
    STANDARD_SIZES.forEach(s=>{
      const d=Math.abs(w-s.w)+Math.abs(l-s.l);
      if(!best||d<best.d||(d===best.d&&s.w*s.l<best.w*best.l))
        best={...s,d};
    });
    body.push([...r,`${best.w}x${best.l}`,best.name,best.d]);
  }

  render(out,body);
  downloadBtn.disabled=false;
};

function render(h,rows){
  const t=document.createElement("table");
  const tr=document.createElement("tr");
  h.forEach(x=>{const th=document.createElement("th");th.textContent=x;tr.appendChild(th)});
  t.appendChild(tr);
  rows.slice(0,200).forEach(r=>{
    const tr=document.createElement("tr");
    r.forEach(c=>{const td=document.createElement("td");td.textContent=c||"";tr.appendChild(td)});
    t.appendChild(tr);
  });
  previewWrap.innerHTML="";
  previewWrap.appendChild(t);
}
</script>
</body>
</html>
